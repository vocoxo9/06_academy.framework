<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODO LIST</title>

	<link rel="stylesheet" href="/css/common.css">
	<link rel="stylesheet" href="/css/todo.css">
	<script src="/js/todo.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container-md">
        <div class="todo-list">
            <div id="title">MY TODO LIST</div>
            <hr>
            <div id="sub-title">TODO</div>
            
            <form action="/todo/regist" method="post">
				<input type="hidden" id="memberNo" name="memberNo" th:value="${session.loginMember.memberNo}" />
                <label for="content"> TODO </label>
                <input type="text" name="content" id="content" maxlength="1000" required>

                <label for="deadline"> 마감일 </label>
                <input type="date" name="deadline" id="deadline">

                <br>
                <div class="buttons">
                    <button type="button" onclick="removeTodo();">－</button>
                    <button type="button" onclick="addTodo();">＋</button>
                    <button id="submit-button">등록</button>
                </div>
            </form>

            <hr>

            <div class="todo-table">
                <table class="table table-hover">
					<thead>
						<tr>
                        	<th>NO</th>
                        	<th>할 일</th>
                        	<th>등록일</th>
                        	<th>마감일</th>
                        	<th>완료 여부</th>
                        	<th></th>
                    	</tr>
					</thead>
                    <tbody>
						<tr th:each="todo : ${todoList}" th:object="${todo}">
							<td th:text="*{todoNo}"></td>
							<td th:text="*{content}"></td>
							<td th:text="*{registDate}"></td>
							<td th:text="*{deadline}"></td>
							<td th:text="*{completion != 'INCOMPLETE' ? 'O' : 'X'}"></td>
							<td><input type="checkbox" name="complition" id="complition"></td>
						</tr>
					</tbody>
                </table>
            </div>
        </div>
        
        <a href="/" class="btn btn-light" >메인</a>
    </div>
	
	<!-- TODO LIST 수정 모달 -->
	<div class="modal fade" id="todoDetailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title fs-5" id="exampleModalLabel">TODO 수정하기</h1>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        <form>
	          <div class="mb-3">
	            <label for="message-text" class="col-form-label">할 일</label>
	            <textarea class="form-control" id="message-text" 
				  name="content"></textarea>
	          </div>
	          <div class="mb-3">
	            <label for="recipient-name" class="col-form-label">마감일</label>
	            <input type="date" class="form-control" id="recipient-name" name="deadline">
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
			<input type="hidden" id="todoNo" name="todoNo">
			<input type="hidden" id="memberNo" name="memberNo" th:value="${session.loginMember.memberNo}" />
	        <button type="button" id="deleteButton" class="btn btn-secondary" data-bs-dismiss="modal">삭제</button>
	        <button type="button" id="updateButton" class="btn btn-light">수정</button>
	      </div>
	    </div>
	  </div>
	</div>
	
    <!-- <script>
	
		// 목록 클릭 시 상세페이지 모달
		const todoTr = document.querySelectorAll(".todo-table tbody tr");

		for(const tr of todoTr){
			tr.onclick = function(){
				// 각 셀의 데이터 가져오기
				const tds = this.querySelectorAll("td");

				const todoNo = tds[0].innerText;
				const content = tds[1].innerText;
				//console.log(tds[3]);
				
				// 날짜 변환
				function formatDate(str) {
				    return "20" + str.replace(/\//g, '-').trim();
				}
				const rawDeadline = tds[3].innerText;
				const deadline = formatDate(rawDeadline);
				console.log(deadline);
				
				// 모달 입력칸에 값 세팅
				$("#todoNo").val(todoNo);
				$("#message-text").val(content);
				$("#recipient-name").val(deadline);
				
				const modal = new bootstrap.Modal(document.getElementById('todoDetailModal'));
				modal.show();
			}
		}
		
		
			// 수정 버튼 클릭 시
			$("#updateButton").click(function () {
				const todoNo = $("#todoNo").val();
				const content = $("#message-text").val();
				const deadline = $("#recipient-name").val();
				const memberNo = $("#memberNo").val();
				
				$.ajax({
					url: '/todo/update',
					type: "POST",
					data: {
						todoNo: todoNo,
						content: content,
						deadline: deadline,
						memberNo : memberNo
					},
					success: function (result) {
						if(result === "success"){
							location.reload();			
						} else {
							alert("TODO 수정에 실패하였습니다.");
						}
					},
					error: function () {
						alert("통신 실패");
					}
				});
			});
		
			// 삭제 버튼 클릭 시
			$("#deleteButton").click(function () {
				const todoNo = $("#todoNo").val();
				console.log(todoNo);
				if (!confirm("정말 삭제하시겠습니까?")) return;

				$.ajax({
					url: '/todo/delete',
					type: "POST",
					data: { todoNo: todoNo },
					success: function (result) {
						if(result == "success"){
							alert("삭제 성공");
							location.reload();					
						} else {
							alert(" 삭제 실패");
						}
					},
					error: function () {
						alert("통신 실패");
					}
				});
			});
			
    </script> -->
</body>

</html>